<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Avalon - Mestre do Jogo</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üëë</text></svg>"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link href="src/assets/fontawesome/css/fontawesome.css" rel="stylesheet" />
    <link href="src/assets/fontawesome/css/all.css" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Bot√µes Flutuantes (Configura√ß√µes + Manual + Guia) -->
    <div class="floating-buttons">
      <button
        class="floating-btn"
        onclick="app.openSettings()"
        data-tooltip="Configura√ß√µes"
      >
        <i class="fas fa-cog"></i>
      </button>
      <a
        href="manual.html"
        class="floating-btn"
        data-tooltip="Manual de Regras"
      >
        <i class="fas fa-book"></i>
      </a>
      <button
        class="floating-btn"
        onclick="app.openGameGuide()"
        data-tooltip="Guia do Jogo"
      >
        <i class="fas fa-map-marked-alt"></i>
      </button>
    </div>

    <!-- T√≠tulo Principal -->
    <div class="game-title">
      <h2 class="sub-title">THE RESISTANCE</h2>
      <h1 class="main-title">AVALON</h1>
    </div>

    <div class="container">
      <!-- Seletor de N√∫mero de Jogadores -->
      <div class="section">
        <h2 class="section-title">N√∫mero de Jogadores</h2>
        <div class="player-selector" id="playerSelector"></div>
      </div>

      <!-- Pap√©is do Bem -->
      <div class="section">
        <h2 class="section-title" id="goodRolesTitle">For√ßas do Bem ‚öîÔ∏è</h2>
        <div class="role-grid" id="goodRoles"></div>
      </div>

      <!-- Pap√©is do Mal -->
      <div class="section">
        <h2 class="section-title" id="evilRolesTitle">For√ßas do Mal üó°Ô∏è</h2>
        <div class="role-grid" id="evilRoles"></div>
      </div>

      <!-- Bot√µes de A√ß√£o -->
      <div class="action-buttons">
        <button class="btn btn-reset" id="resetBtn" onclick="app.resetRoles()">
          <i class="fas fa-redo-alt"></i> Resetar
        </button>
        <button
          class="btn btn-start"
          id="startBtn"
          onclick="app.startNarration()"
          disabled
        >
          <i class="fas fa-play"></i> Iniciar Narra√ß√£o
        </button>
      </div>

      <!-- Player de √Åudio -->
      <div class="audio-player" id="audioPlayer" style="display: none">
        <!-- Cabe√ßalho com bot√£o de configura√ß√µes -->
        <div class="narration-header">
          <h3 class="audio-step" id="audioStep">Etapa 1 de X</h3>
          <button
            id="settingsBtnNarration"
            class="settings-btn-icon"
            onclick="app.openSettings()"
            style="display: none"
          >
            <i class="fas fa-cog"></i>
          </button>
        </div>

        <div class="audio-text" id="audioText">Preparando narra√ß√£o...</div>

        <!-- Contador de Pausa -->
        <div class="pause-counter" id="pauseCounter">
          <i class="fal fa-clock"></i>
          <span>Pausa:</span>
          <span id="pauseSeconds">5</span>
          <span>segundos</span>
        </div>

        <!-- Grid de Controles (3 colunas) -->
        <div class="playback-controls-grid">
          <!-- ESQUERDA: Volume Narra√ß√£o -->
          <div class="narration-volume">
            <i class="fal fa-microphone"></i>
            <input
              type="range"
              min="50"
              max="150"
              value="100"
              id="narrationVolumeQuick"
              oninput="app.updateNarrationVolumeQuick(this.value)"
            />
            <span id="volumeDisplayQuick">100%</span>
          </div>

          <!-- CENTRO: Controles de Navega√ß√£o -->
          <div class="audio-controls">
            <button
              class="control-btn"
              id="prevBtn"
              onclick="app.previousAudio()"
              disabled
            >
              <i class="fas fa-step-backward"></i>
            </button>
            <button
              class="control-btn control-btn-main"
              id="playPauseBtn"
              onclick="app.togglePlayPause()"
            >
              <i class="fas fa-pause"></i>
            </button>
            <button class="control-btn" id="nextBtn" onclick="app.nextAudio()">
              <i class="fas fa-step-forward"></i>
            </button>
          </div>

          <!-- DIREITA: Toggle M√∫sica -->
          <div class="music-toggle-container">
            <button
              class="music-toggle-btn active"
              id="musicToggle"
              onclick="app.toggleMusic()"
            >
              <i class="fas fa-music"></i>
            </button>
          </div>
        </div>

        <button class="btn btn-close" onclick="app.stopNarration()">
          <i class="fas fa-times"></i> Encerrar Narra√ß√£o
        </button>
      </div>
    </div>

    <!-- Modal de Configura√ß√µes -->
    <div id="settingsModal" class="modal" style="display: none">
      <div class="modal-backdrop" onclick="app.closeSettings()"></div>
      <div class="modal-content">
        <h2 class="modal-title">‚öôÔ∏è CONFIGURA√á√ïES</h2>

        <!-- M√∫sica de Fundo (unificado) -->
        <div class="setting-item">
          <label class="setting-label">
            <i class="fal fa-music" id="musicIconModal"></i> M√∫sica de Fundo
          </label>
          <div class="music-control-unified">
            <button
              class="music-toggle-modal active"
              id="musicToggleModal"
              onclick="app.toggleMusicFromModal()"
            >
              <i class="far fa-music-slash"></i>
            </button>
            <div class="slider-container">
              <input
                type="range"
                min="0"
                max="100"
                value="15"
                id="musicVolumeSetting"
                oninput="app.updateSettingPreview()"
              />
              <span id="musicVolumeDisplay" class="slider-value">15%</span>
            </div>
          </div>
        </div>

        <!-- Volume Narra√ß√£o -->
        <div class="setting-item">
          <label class="setting-label">
            <i class="fal fa-microphone"></i> Volume da Narra√ß√£o
          </label>
          <div class="slider-container">
            <input
              type="range"
              min="50"
              max="150"
              value="100"
              id="narrationVolumeSetting"
              oninput="app.updateSettingPreview()"
            />
            <span id="narrationVolumeDisplay" class="slider-value">100%</span>
          </div>
          <p class="setting-hint">50% - 150%</p>
        </div>

        <!-- Timer: A√ß√µes de personagem -->
        <div class="setting-item">
          <label class="setting-label">
            <i class="fal fa-clock"></i> Timer: A√ß√µes de personagem
          </label>
          <div class="slider-container">
            <input
              type="range"
              min="1"
              max="10"
              value="5"
              id="pauseDurationSetting"
              oninput="app.updateSettingPreview()"
            />
            <span id="pauseDurationDisplay" class="slider-value">5s</span>
          </div>
        </div>

        <div class="modal-actions">
          <button class="btn btn-primary" onclick="app.saveSettings()">
            <i class="fas fa-check"></i> Salvar
          </button>
          <button class="btn btn-reset" onclick="app.resetSettingsPreview()">
            <i class="fas fa-undo"></i> Restaurar Padr√µes
          </button>
          <button class="btn btn-secondary" onclick="app.closeSettings()">
            <i class="fas fa-times"></i> Cancelar
          </button>
        </div>
      </div>
    </div>

    <!-- Modal do Guia do Jogo -->
    <div id="gameGuideModal" class="modal" style="display: none">
      <div class="modal-backdrop" onclick="app.closeGameGuide()"></div>
      <div class="modal-content modal-content-wide">
        <!-- Bot√£o de fechar no canto superior direito -->
        <button
          class="modal-close-btn"
          onclick="app.closeGameGuide()"
          title="Fechar"
        >
          <i class="fas fa-times"></i>
        </button>

        <h2 class="modal-title">üó∫Ô∏è GUIA DO JOGO</h2>

        <!-- Se√ß√£o de Recursos Opcionais -->
        <div class="guide-section">
          <h3 class="guide-section-title">
            <i class="fas fa-toggle-on"></i> Recursos Opcionais
          </h3>
          <p class="guide-hint">
            Selecione os recursos que deseja usar nesta partida:
          </p>

          <div class="optional-features">
            <div class="feature-toggle">
              <input
                type="checkbox"
                id="toggleLancelots"
                onchange="app.updateGameSteps()"
              />
              <label for="toggleLancelots">
                <span class="feature-icon">üîÑ</span>
                <div class="feature-info">
                  <strong>Lancelots</strong>
                  <small>Lancelots podem trocar de lado durante o jogo</small>
                </div>
              </label>
            </div>

            <div class="feature-toggle">
              <input
                type="checkbox"
                id="toggleExcalibur"
                onchange="app.updateGameSteps()"
              />
              <label for="toggleExcalibur">
                <span class="feature-icon">üó°Ô∏è</span>
                <div class="feature-info">
                  <strong>Excalibur</strong>
                  <small>Permite alterar o resultado da miss√£o</small>
                </div>
              </label>
            </div>

            <div class="feature-toggle">
              <input
                type="checkbox"
                id="toggleTargeting"
                onchange="app.updateGameSteps()"
              />
              <label for="toggleTargeting">
                <span class="feature-icon">üéØ</span>
                <div class="feature-info">
                  <strong>Miss√£o Alvo</strong>
                  <small>Miss√µes podem ser feitas em qualquer ordem</small>
                </div>
              </label>
            </div>

            <div class="feature-toggle">
              <input
                type="checkbox"
                id="toggleLadyOfLake"
                onchange="app.updateGameSteps()"
              />
              <label for="toggleLadyOfLake">
                <span class="feature-icon">üíß</span>
                <div class="feature-info">
                  <strong>Mulher do Lago</strong>
                  <small>Permite examinar a lealdade de outros jogadores</small>
                </div>
              </label>
            </div>
          </div>
        </div>

        <!-- Se√ß√£o de Etapas do Jogo -->
        <div class="guide-section">
          <div class="guide-steps-header">
            <h3 class="guide-section-title">
              <i class="fas fa-list-ol"></i> Etapas do Jogo
              <span id="stepCounter" class="step-counter-text"></span>
            </h3>
            <div class="step-navigation">
              <button
                class="step-nav-btn"
                id="prevStepBtn"
                onclick="app.previousStep()"
                disabled
              >
                <i class="fas fa-chevron-left"></i>
              </button>
              <button
                class="step-nav-btn"
                id="nextStepBtn"
                onclick="app.nextStep()"
              >
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
          <div id="gameStepsContainer" class="game-steps-container">
            <!-- As etapas ser√£o inseridas aqui dinamicamente -->
          </div>
        </div>

        <!-- Se√ß√£o de Condi√ß√µes de Vit√≥ria -->
        <div class="guide-section">
          <h3 class="guide-section-title">
            <i class="fas fa-trophy"></i> Condi√ß√µes de Vit√≥ria
          </h3>
          <p class="guide-hint">
            O jogo termina quando um dos times atinge seus objetivos de vit√≥ria:
          </p>

          <!-- Grid de Condi√ß√µes de Vit√≥ria -->
          <div class="victory-conditions-grid">
            <!-- Vit√≥rias do BEM -->
            <div class="victory-group victory-good">
              <div class="victory-header">
                <i class="fas fa-shield-alt"></i>
                <span>BEM Vence Se...</span>
              </div>

              <div class="victory-condition">
                <div class="condition-icon">üòÑ</div>
                <div class="condition-text">
                  <strong>3 miss√µes bem-sucedidas</strong>
                  <small>Complete tr√™s miss√µes com sucesso</small>
                </div>
              </div>

              <div class="victory-and">E</div>

              <div class="victory-condition">
                <div class="condition-icon">üßôüèª‚Äç‚ôÇÔ∏è</div>
                <div class="condition-text">
                  <strong>Merlin sobrevive</strong>
                  <small>O Assassino erra ao tentar mat√°-lo</small>
                </div>
              </div>
            </div>

            <!-- Vit√≥rias do MAL -->
            <div class="victory-group victory-evil">
              <div class="victory-header">
                <i class="fas fa-skull-crossbones"></i>
                <span>MAL Vence Se...</span>
              </div>

              <div class="victory-condition">
                <div class="condition-icon">üòà</div>
                <div class="condition-text">
                  <strong>3 miss√µes falharem</strong>
                  <small>Sabote tr√™s miss√µes</small>
                </div>
              </div>

              <div class="victory-or">OU</div>

              <div class="victory-condition">
                <div class="condition-icon">ü§Ø</div>
                <div class="condition-text">
                  <strong>5 times rejeitados</strong>
                  <small
                    >Gere confus√£o o suficiente para n√£o confiarem em
                    ningu√©m</small
                  >
                </div>
              </div>

              <div class="victory-or">OU</div>

              <div class="victory-condition">
                <div class="condition-icon">üíÄ</div>
                <div class="condition-text">
                  <strong>Assassinar Merlin</strong>
                  <small>Identifique quem conhece o mal e mate Merlin</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="app-mp3.js"></script>
    <script src="game-guide.js"></script>
  </body>
</html>
